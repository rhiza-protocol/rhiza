<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhiza Wallet</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŒ¿</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #111827;
            --bg-card: #1a2332;
            --bg-card-hover: #1f2b3d;
            --border: #2a3a4e;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --green: #10b981;
            --green-dim: #059669;
            --green-glow: rgba(16, 185, 129, 0.15);
            --green-glow-strong: rgba(16, 185, 129, 0.3);
            --purple: #8b5cf6;
            --red: #ef4444;
            --orange: #f59e0b;
            --blue: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* === Background glow === */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse at 30% 20%, var(--green-glow) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(139, 92, 246, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* === Header === */
        .header {
            padding: 20px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(20px);
            background: rgba(10, 14, 23, 0.8);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 22px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-icon {
            font-size: 28px;
        }

        .logo span {
            color: var(--green);
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            background: var(--green-glow);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 100px;
            font-size: 13px;
            font-weight: 500;
            color: var(--green);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5);
            }

            50% {
                opacity: 0.8;
                box-shadow: 0 0 0 6px rgba(16, 185, 129, 0);
            }
        }

        /* === Main Layout === */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* === Balance Card === */
        .balance-card {
            background: linear-gradient(135deg, #0f2027 0%, #1a2332 50%, #0f1923 100%);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--green-glow-strong) 0%, transparent 70%);
            pointer-events: none;
        }

        .balance-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 8px;
        }

        .balance-amount {
            font-size: 56px;
            font-weight: 800;
            letter-spacing: -2px;
            line-height: 1.1;
            margin-bottom: 4px;
        }

        .balance-amount .currency {
            font-size: 28px;
            font-weight: 500;
            color: var(--green);
            margin-left: 8px;
            letter-spacing: 0;
        }

        .balance-usd {
            font-size: 16px;
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        .founder-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 100px;
            font-size: 14px;
            font-weight: 600;
            color: var(--orange);
        }

        .address-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 20px;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .address-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .address-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .copy-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
            border-color: var(--green);
        }

        .copy-btn.copied {
            background: var(--green-glow);
            color: var(--green);
            border-color: var(--green);
        }

        /* === Action Grid === */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .action-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
        }

        .action-card:hover {
            background: var(--bg-card-hover);
            border-color: var(--green);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.1);
        }

        .action-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .action-desc {
            font-size: 13px;
            color: var(--text-muted);
        }

        /* === Stats Grid === */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .stat-value.green {
            color: var(--green);
        }

        .stat-value.purple {
            color: var(--purple);
        }

        .stat-value.blue {
            color: var(--blue);
        }

        .stat-value.orange {
            color: var(--orange);
        }

        /* === Transactions === */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .tx-list {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .tx-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            transition: background 0.2s;
        }

        .tx-item:last-child {
            border-bottom: none;
        }

        .tx-item:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .tx-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-right: 14px;
            flex-shrink: 0;
        }

        .tx-icon.receive {
            background: var(--green-glow);
        }

        .tx-icon.send {
            background: rgba(239, 68, 68, 0.1);
        }

        .tx-icon.genesis {
            background: rgba(139, 92, 246, 0.1);
        }

        .tx-icon.founder {
            background: rgba(245, 158, 11, 0.1);
        }

        .tx-details {
            flex: 1;
            min-width: 0;
        }

        .tx-type {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .tx-id {
            font-size: 12px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tx-amount {
            font-size: 16px;
            font-weight: 600;
            text-align: right;
            white-space: nowrap;
        }

        .tx-amount.positive {
            color: var(--green);
        }

        .tx-amount.negative {
            color: var(--red);
        }

        .tx-empty {
            padding: 40px;
            text-align: center;
            color: var(--text-muted);
            font-size: 14px;
        }

        /* === Send Modal === */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            width: 100%;
            max-width: 480px;
            animation: modalIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: var(--green);
            box-shadow: 0 0 0 3px var(--green-glow);
        }

        .form-input::placeholder {
            color: var(--text-muted);
            font-family: 'Inter', sans-serif;
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .btn {
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: var(--green);
            color: #000;
            width: 100%;
        }

        .btn-primary:hover {
            background: #34d399;
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
            margin-top: 12px;
            width: 100%;
        }

        .btn-secondary:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        /* === Toast === */
        .toast {
            position: fixed;
            bottom: 32px;
            right: 32px;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 2000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--green);
            color: #000;
        }

        .toast.error {
            background: var(--red);
            color: #fff;
        }

        /* === Responsive === */
        @media (max-width: 768px) {
            .header {
                padding: 16px 20px;
            }

            .container {
                padding: 20px 16px;
            }

            .balance-card {
                padding: 28px 24px;
            }

            .balance-amount {
                font-size: 36px;
            }

            .balance-amount .currency {
                font-size: 20px;
            }

            .actions-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .action-card {
                padding: 16px;
            }

            .action-icon {
                font-size: 24px;
                margin-bottom: 8px;
            }

            .action-title {
                font-size: 13px;
            }

            .action-desc {
                display: none;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .address-row {
                flex-wrap: wrap;
            }
        }

        /* === Loading Skeleton === */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-card) 25%, var(--bg-card-hover) 50%, var(--bg-card) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }
    </style>
</head>

<body>

    <!-- Header -->
    <header class="header">
        <div class="logo">
            <span class="logo-icon">ðŸŒ¿</span>
            Rhiza <span>Wallet</span>
        </div>
        <div class="status-badge" id="statusBadge">
            <div class="status-dot"></div>
            <span id="statusText">Connecting...</span>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">

        <!-- Balance Card -->
        <div class="balance-card">
            <div class="balance-label">Total Balance</div>
            <div class="balance-amount">
                <span id="balanceAmount">0</span>
                <span class="currency">RHZ</span>
            </div>
            <div class="balance-usd" id="balanceInfo">Loading...</div>
            <div id="founderBadge" style="display:none;">
                <span class="founder-badge">ðŸ‘‘ Protocol Founder</span>
            </div>
            <div class="address-row">
                <span class="address-label">Address</span>
                <span class="address-value" id="walletAddress">â€”</span>
                <button class="copy-btn" onclick="copyAddress()" id="copyBtn">Copy</button>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="actions-grid">
            <div class="action-card" onclick="openSendModal()">
                <div class="action-icon">ðŸ“¤</div>
                <div class="action-title">Send</div>
                <div class="action-desc">Transfer RHZ</div>
            </div>
            <div class="action-card" onclick="copyAddress()">
                <div class="action-icon">ðŸ“¥</div>
                <div class="action-title">Receive</div>
                <div class="action-desc">Share address</div>
            </div>
            <div class="action-card" onclick="claimRelay()">
                <div class="action-icon">ðŸ”„</div>
                <div class="action-title">Relay</div>
                <div class="action-desc">Claim reward</div>
            </div>
        </div>

        <!-- Node Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">DAG Size</div>
                <div class="stat-value green" id="dagSize">â€”</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">DAG Depth</div>
                <div class="stat-value purple" id="dagDepth">â€”</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Relays</div>
                <div class="stat-value blue" id="totalRelays">â€”</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Tips</div>
                <div class="stat-value orange" id="tipsCount">â€”</div>
            </div>
        </div>

        <!-- Transactions -->
        <div class="section-header">
            <h2 class="section-title">Transactions</h2>
        </div>
        <div class="tx-list" id="txList">
            <div class="tx-empty">Loading transactions...</div>
        </div>
    </div>

    <!-- Send Modal -->
    <div class="modal-overlay" id="sendModal">
        <div class="modal">
            <div class="modal-title">ðŸ“¤ Send RHZ</div>
            <form onsubmit="sendTransaction(event)">
                <div class="form-group">
                    <label class="form-label">Recipient Public Key</label>
                    <input type="text" class="form-input" id="recipientKey" placeholder="64 character hex public key..."
                        maxlength="64">
                    <div class="form-hint">Enter the recipient's 64-char hex public key</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Amount (RHZ)</label>
                    <input type="number" class="form-input" id="sendAmount" placeholder="0.00" step="0.01" min="0.01">
                    <div class="form-hint">
                        Available: <strong id="availableBalance">0</strong> RHZ
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" id="sendBtn">Send RHZ</button>
                <button type="button" class="btn btn-secondary" onclick="closeSendModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        const API_BASE = window.location.origin;
        let walletInfo = null;

        // --- API calls ---
        async function fetchInfo() {
            try {
                const res = await fetch(`${API_BASE}/info`);
                walletInfo = await res.json();
                updateUI();
            } catch (e) {
                document.getElementById('statusText').textContent = 'Disconnected';
                document.getElementById('statusBadge').querySelector('.status-dot').style.background = '#ef4444';
            }
        }

        async function fetchTransactions() {
            try {
                const res = await fetch(`${API_BASE}/transactions`);
                const txs = await res.json();
                renderTransactions(txs);
            } catch (e) {
                // Endpoint might not exist yet
                document.getElementById('txList').innerHTML = '<div class="tx-empty">No transactions yet</div>';
            }
        }

        // --- UI Updates ---
        function updateUI() {
            if (!walletInfo) return;

            // Status
            document.getElementById('statusText').textContent = 'Node Active';

            // Balance
            const rhz = walletInfo.balance_rhz;
            document.getElementById('balanceAmount').textContent = formatNumber(rhz);
            document.getElementById('availableBalance').textContent = formatNumber(rhz);

            // Founder check
            const isFounder = walletInfo.public_key === 'cd3f2d882dd11f282e13f641b6aa751a3d46b3ff5a9efbccebea9a0131c0dfdd';
            if (isFounder) {
                document.getElementById('founderBadge').style.display = 'block';
                document.getElementById('balanceInfo').textContent = '5% Genesis Allocation â€¢ Protocol Founder';
            } else {
                document.getElementById('balanceInfo').textContent = `${walletInfo.balance.toLocaleString()} units`;
            }

            // Address
            document.getElementById('walletAddress').textContent = walletInfo.address;

            // Stats
            document.getElementById('dagSize').textContent = walletInfo.dag_size;
            document.getElementById('dagDepth').textContent = walletInfo.dag_depth;
            document.getElementById('totalRelays').textContent = walletInfo.total_relays;
            document.getElementById('tipsCount').textContent = walletInfo.tips_count;
        }

        function renderTransactions(txs) {
            const list = document.getElementById('txList');
            if (!txs || txs.length === 0) {
                list.innerHTML = '<div class="tx-empty">No transactions yet</div>';
                return;
            }

            list.innerHTML = txs.map(tx => {
                let icon, iconClass, typeName, amountClass, amountText;

                switch (tx.tx_type) {
                    case 'Genesis':
                        icon = 'ðŸŒ±'; iconClass = 'genesis'; typeName = 'Genesis';
                        amountText = 'â€”'; amountClass = '';
                        break;
                    case 'FounderAllocation':
                        icon = 'ðŸ‘‘'; iconClass = 'founder'; typeName = 'Founder Allocation';
                        amountText = `+${formatNumber(tx.amount_rhz)} RHZ`;
                        amountClass = 'positive';
                        break;
                    case 'RelayReward':
                        icon = 'ðŸ”„'; iconClass = 'receive'; typeName = 'Relay Reward';
                        amountText = `+${formatNumber(tx.amount_rhz)} RHZ`;
                        amountClass = 'positive';
                        break;
                    case 'Transfer':
                        if (tx.is_incoming) {
                            icon = 'ðŸ“¥'; iconClass = 'receive'; typeName = 'Received';
                            amountText = `+${formatNumber(tx.amount_rhz)} RHZ`;
                            amountClass = 'positive';
                        } else {
                            icon = 'ðŸ“¤'; iconClass = 'send'; typeName = 'Sent';
                            amountText = `-${formatNumber(tx.amount_rhz)} RHZ`;
                            amountClass = 'negative';
                        }
                        break;
                    default:
                        icon = 'ðŸ“‹'; iconClass = 'genesis'; typeName = tx.tx_type;
                        amountText = `${formatNumber(tx.amount_rhz)} RHZ`;
                        amountClass = '';
                }

                return `
                    <div class="tx-item">
                        <div class="tx-icon ${iconClass}">${icon}</div>
                        <div class="tx-details">
                            <div class="tx-type">${typeName}</div>
                            <div class="tx-id">${tx.id}</div>
                        </div>
                        <div class="tx-amount ${amountClass}">${amountText}</div>
                    </div>
                `;
            }).join('');
        }

        // --- Actions ---
        function openSendModal() {
            document.getElementById('sendModal').classList.add('active');
        }

        function closeSendModal() {
            document.getElementById('sendModal').classList.remove('active');
        }

        async function sendTransaction(e) {
            e.preventDefault();
            const btn = document.getElementById('sendBtn');
            const recipient = document.getElementById('recipientKey').value.trim();
            const amountRhz = parseFloat(document.getElementById('sendAmount').value);

            if (!recipient || recipient.length !== 64) {
                showToast('Invalid public key (must be 64 hex characters)', 'error');
                return;
            }

            if (!amountRhz || amountRhz <= 0) {
                showToast('Invalid amount', 'error');
                return;
            }

            const amountUnits = Math.floor(amountRhz * 100_000_000);
            btn.disabled = true;
            btn.textContent = 'Sending...';

            try {
                const res = await fetch(`${API_BASE}/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        recipient_pubkey_hex: recipient,
                        amount: amountUnits
                    })
                });

                if (!res.ok) {
                    const error = await res.text();
                    throw new Error(error);
                }

                const result = await res.json();
                showToast(`Sent ${amountRhz} RHZ! TX: ${result.id.slice(0, 16)}...`, 'success');
                closeSendModal();
                document.getElementById('recipientKey').value = '';
                document.getElementById('sendAmount').value = '';
                refreshAll();
            } catch (err) {
                showToast(`Failed: ${err.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Send RHZ';
            }
        }

        async function claimRelay() {
            try {
                const res = await fetch(`${API_BASE}/relay-reward`, { method: 'POST' });
                if (!res.ok) {
                    const error = await res.text();
                    throw new Error(error);
                }
                const result = await res.json();
                showToast('Relay reward claimed! ðŸŽ‰', 'success');
                refreshAll();
            } catch (err) {
                showToast(`${err.message}`, 'error');
            }
        }

        function copyAddress() {
            if (!walletInfo) return;
            navigator.clipboard.writeText(walletInfo.address).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.textContent = 'âœ“ Copied';
                btn.classList.add('copied');
                showToast('Address copied to clipboard!', 'success');
                setTimeout(() => {
                    btn.textContent = 'Copy';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        // --- Utils ---
        function formatNumber(n) {
            if (n === undefined || n === null) return '0';
            if (n >= 1_000_000) return (n / 1_000_000).toFixed(2).replace(/\.?0+$/, '') + 'M';
            if (n >= 1_000) return n.toLocaleString('en-US', { maximumFractionDigits: 2 });
            return n.toFixed(n % 1 === 0 ? 0 : 4);
        }

        function showToast(msg, type) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function refreshAll() {
            fetchInfo();
            fetchTransactions();
        }

        // Close modal on overlay click
        document.getElementById('sendModal').addEventListener('click', function (e) {
            if (e.target === this) closeSendModal();
        });

        // Close modal on Escape
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeSendModal();
        });

        // Initial load + auto-refresh
        refreshAll();
        setInterval(refreshAll, 5000);
    </script>
</body>

</html>